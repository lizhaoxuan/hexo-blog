
---
title: App自动化测试探索1-大话App自动化测试
date: 2017-2-15 16:20:58
author : 暴打小女孩

tags: 测试
---

转载请注明出处：https://lizhaoxuan.github.io

## 前言

最近连续出现因为回归测试不够充足导致的线上事故。一次还好，但连着几次真的是被打痛了。业务无限复杂化，回归测试心有而余力不足，OK，一直被拖着的自动化测试终于被压力push到了日程上。

简单考察了几种自动化测试方案，考虑学习成本，多平台扩展，可理解程度，最后选择了一个较为偏冷，但一眼看过去就很喜欢的一个技术方案：Calabash。**所以，这实际是一篇关于Calabash教程的系列博客！**

不过在这个系列的第一章，我想更多聊聊自动化测试，而不是具体的实现技术。
首先，主流的自动化测试方案的对比不在本系列探讨范围，网上这方面的博客已经非常非常多了。
其次，提到Calabash，就一定要说Cucumber（Calabash的核心）,那定然会引入一个高大上的词BDD（行为驱动开发），但这在这个系列同样不想谈，不说目前BDD还有点类似乌邦托是一种理想化的状态，只是不想在这些概念上的问题纠结太多。能解决问题就好！

<!-- more -->

提到自动化测试，种种细分的边界case,一个必然很繁琐的东西想一想就更繁琐了,所以大部分的人止步于了想想~
所以第一步，除了介绍我对自动化测试一些想法以外，我要帮助你降低期望，迈出第一步，敏捷开发同样适用于测试用例的编写。既然上路了，你也不好意思那么果断的就放弃之前的劳动成果。
同样还要聊聊Calabash的优缺点，为你画一个好像挺好吃的大饼。
然后在后续篇章再对Calabash逐步展开并深入。



## 大话App客户端自动化测试

仅代表个人观点，见识还浅，欢迎多多打脸。

### 现状

以Android为例，从2010年开始，Android开发环境以及其迅猛的态势发展到今天，几近趋于成熟，开发者的目光早已不在局限于这单一的开发平台，开始寻求Android，ios在开发上的统一：ReactNactive,WEEX,H5……

开发环境已经成熟，但移动客户端的测试环境却有些滞后。这中间的几座大山是很多团队正在面对且驻足的：

1.App测试不像服务端测试,通常只需对数据本身进行验证即可，App涉及到界面展示及交互，自动化识别的难度很大。
2.互联网企业一直都在追寻快速迭代，且App直接对接用户，App的界面与逻辑变更更是家常便饭，编写自动化测试脚本的稳定性很差。
3.Android IOS 双平台,甚至可以加上早前已死的WP，或web页面。如此多的平台想要依靠一套代码进行自动化测试几乎是不可能的。再考虑需要经常变更，你懂得。

所以往往一个完善的移动自动化测试环境需要一个庞大的测试团队支撑，但一个庞大的测试团队只有大公司才能负担的起。移动的自动化测试，一直都在被中小型的创业公司所忽略。小团队开发自测了事，中型团队依靠测试人员人工操作进行验证。

自动化测试真的对于中小型团队紧闭大门吗？


### 吹牛逼时间到了~

对于自动化测试：

#### 1.设定明确的目标

设定一个明确的目标，然后你才能把活分下去。
- 你到底想要黑盒测试还是白盒测试？
- 你到底想要测试前端展示还是测试后端数据？
- 你到底想要业务逻辑测试还是兼容性测试还是压力测试？

设定一个明确的目标，你才能决定测试脚本是由测试人员来做还是开发来做，才能决定是否要在App代码中编写配合测试的代码。只有分对了活才能做好事儿对吧？

**如果你想要一套工具全包了的，拉倒吧，别做白日梦了。**
别说你没这么想过，你是没想过用一种方式把上面的所有点都测了，但你绝对有意无意的想过用客户端自动化测试把前后端逻辑都测通，肯定想过用一种方式搞定业务、兼容、压力中的任意两个。最起码，你也是有这种奢望的。放弃吧骚年~
这就是下面紧接着要说的一点：**降低期望**


#### 2.降低期望

在人工（对着手机点点点）测试的环境下，我们通常都是通过操作App进行各种case验证，只要操作app验证通过了那就没有问题了。但这个前提是人工验证是人脑加肉眼，它会有更准确的主观判断。
涉及到前后端交互会增加极大的复杂性，你的测试case不会无限多无限精细，但作为人脑你可以在有限的case执行中发现更多不符合常理的bug：文字不合理的折行，不准确的数值显示，按钮颜色不对，Toast展示数量有误等等等。自动化测试会死板的跟着你写的脚本走，你能保证你的case覆盖到了所有了吗？

首先你一定一定要认清的一点，客户端自动化测试通过了都不能保证客户端测试ok了，说不得特殊功能还需要你盯着或后期检查截图进行验证，前期，前后端自动化测试绝对要分开来，如果不分开，你会发现在app自动化测试有限的条件下，并不能实现想要的结果，从而迫于压力放弃。

- 降低期望，先以回归为目标
- 降低期望，前后端自动化测试都要有，一套解决不了问题
- 降低期望，客户端自动化测试限制依然很多，人工测试验证不能全部丢下
- 降低期望，一口吃不成个胖子，自动化测试也是需要慢慢迭代的完善的，先跑通再关心验证异常case。快速迭代，逐步完善
- 降低期望，术业有专攻，不同类型测试采用不同技术选型


#### 3.术业有专攻

这里说的术业有专攻说的就不是 “不同类型测试采用不同技术选型”了，我们来谈谈测试人员与开发人员。

作为开发人员谈测试，你可能会比较骄傲的想，这是我写的代码，我知道实现过程，了解更多的细节，能提出更有针对性的case。
作为测试人员谈测试，你可能会比较骄傲的想，我就是干这个的，测试用例就是我吃饭的家伙，我考虑的更全面，写的测试用例更完善。

没错，这是在测试用例上，开发和测试两者不同的优势，同时也是对方的劣势。
开发写测试用例往往不够全面，且经常会漏掉他认为肯定不会出问题的点，但往往bug就出到这上面了（不服的话就想想，为啥你自测通过了，测试还是能给你提一大堆bug！）。
测试写测试用例因为不知道具体的细节实现，case漏掉了一些逻辑分支的情况下，就会跳过这个风险点。你可以理解为开发给测试埋了个深坑！

所以，自动化测试这种脱离或半脱离主观意识监督的测试，不能完全单独交给测试人员或开发人员来负责，而应该是一种紧密合作的关系。
我的建议是：开发人员编写该业务正常情况的测试case，及开发中的风险点case。测试人员补充其他异常case。（其他自动化测试框架可能这样的实现方案比较难，但Calabash实现起来就较为容易了）

测试深入开发，开发了解测试，也是一种互相成长。

#### 4.一个巴掌拍不响

首先明确我的一个观点：在没有足够的资源的情况下，移动客户端自动化测试，主要针对的应该是回归测试。

自动化测试相比起人工测试，是非常死板的，那么就需要非常“死板”的数据支持.如果是App开发（就像我）去做自动化测试这件事，难道所有数据我都要mock一遍吗？虽说前后端自动化应该分开，但最好还是在较为真实的环境上去测试更为全面，万一我测出来一个后端bug不挺好么。
而且，手机淘宝这样完全to C的应用直接在生产环境测试好像没什么太大问题，但像蜂鸟配送这样半to C的应用来说就比较尴尬，直接去抢线上单明显不可能，那么在测试环境这个订单谁来发怎么发呢？

所以这个时候你就不能自己单干了，去找测试同学，看能不能搞一个配合自动化测试的测试环境，拿抢单来说，我希望这个环境上永远有好多单让我抢。我就是抢单的app，没单我还玩什么。

如果测试同学搞不定，那么就去拉后端的同学啦，我相信为了项目越来越好，他们是不会拒绝你的。

自动化测试，不仅是自动化测试工具就够了，同样还需要测试环境的支持。

### 小结

其实说了这么多，就是想要你降低期望，从而可以迈出第一步。

细分case太多，那么先放一放又如何？反正你都裸奔这么久了，穿裤子不也要先穿个裤衩才行么，裤子慢慢来
数据支持不够？没有订单没法测？这就不是一个单干的活，叫人！

OK，下面我们聊聊这个裤衩，以及怎么穿。

## 为什么选择Calabash

谈Calabash前，先要交代清楚Calabash是啥。

Calabash与appium，macaca类似，都是通过脚本去操作界面，作出点击、滑动等操作，同时可以对界面的上UI组件进行一定识别。run起来就是那么回事，模拟控制手机。主要是脚本的编写上不同，我们来看一下Calabash的脚本，**相信我，爱上它，就从看到它脚本开始**：


```
Feature: Login feature

  Scenario: 登录测试用例

  	When I press view with id "account_edit"
  	Then I enter "15104053650流量" into input field number 1

  	Then I press "发送验证码"
  	Then I wait for 5 seconds

  	When I press view with id "verifying_code_edit"
  	Then I enter "306423" into input field number 2

  	Then I wait for 5 seconds

  	Then I press view with id "login_login"

```


我觉得我不需要再解释这脚本的含义了，这就是大白话！！
**Calabash最大的魅力在于，将难以理解的编程语言转换为谁都可以看得懂得自然语言。**
**特点1：极高的可读性**，测试脚本不像是代码，可读性越高的测试脚本，意义越大。

在可读性非常高的基础上，其编写难度也变得非常的低。**特点2：语法简单易懂，谁都能写**

同时可喜的是，这个代码同时支持Android 和IOS，web也有一定的支持！RN就更不用说了，跑起来的RN就是原生代码！WEEX还要再考察考察~**特点3：支持多种平台**

一段使用自然语言编写的脚本，其底层当然要费一番功夫。上面是用Calabash预定义的Steps写的一段测试用例。预定义的Steps当然不可能满足我们的需求，Calabash灵活的支持**不同程度自定义steps**，你可以简单理解为Calabash支持不同程度的，代码到自然语言的转换。
正是这种灵活的转换方式，让我们有了更多的想象：

**特点4：Steps的开发与脚本的开发解耦分离，降低入门门槛，容纳更多的开发** 
再简单解释一下：先让一部分人学起来，写出一个个大白话似的Steps。再接纳一部分人进来，比如产品经理！直接用这些大白话写测试case，熟悉了之后再去学自定义Steps。甚至产品都不需要学自定义Steps,给开发提需求好了，当你有一个非常丰富的Steps库的时候，你所烦的无穷无尽的边界case，不过就是全民小作文~

**特点5：维护简单，我不知道小作文维护起来有什么难的~**

**特点6：case也有设计感，不在那么枯燥**
在加一个最起码我觉得很兴奋的特点，考虑复用的话，自定义的Steps就要考虑与业务的解耦问题了，有的要解耦有的却要耦合一点。而且如果为了最小程度修改代码从而保证Android Ios在代码上通用，Android和Ios的开发上就会有更多的交流，测试脚本的编写也会有更通用的设计。这里面就有设计的快感了。

**特点7：除模拟事件以外，Calabash还支持各种hook，如App生命周期的hook**

App自动化测试一个普遍的痛点就是元素定位，Calabash有非常多的元素定位辅助方法，虽然有时候需要你动个脑筋~ **特点8：丰富的元素定位辅助方法。**

最后我们在看一个从网上摘下来的一段Calabash脚本：

```
Feature： 登陆

　　Scenario： 输入正确的用户名密码能够正常登陆

　　When 打开登陆页面
　　And    输入用户名XXX输入密码XXX
　　And   点击登陆
　　Then  验证登陆成功

```

完全纯中文的脚本编写有木有？是不看起来屌屌的~恩，博主自身并不建议这样纯中文的step定义，我们就看看，你只要知道Calabash很强大就行了。


最后我们总结一下Calabash的大方向的优点：

- 语法简单易懂
- 极高的可读性
- 一种语言支持多种平台
- Steps的开发与脚本的开发解耦分离，降低入门门槛，容纳更多的开发
- 小作文维护简单
- case也有设计感，不在那么枯燥
- 除模拟事件以外，Calabash还支持各种hook，如App生命周期的hook
- 非常多的元素定位辅助方法
- 对代码无侵入性，拿来一个安装包就能测试。
- 用Calabash搭一个云测平台可行性很高

这只是大方向的几个优点，如果你愿意继续往下看，你会发现Calabash有非常多的深入定制可能。**Calabash是一个轻量但灵活的框架。**

## Calabash缺点

说了那么多优点，缺点当然也是有的啦~我们吐槽一下
### 资料、Demo稀少

Calabash大概有五年以上的历史，最早的first commit是2012年2月份，对于一个技术框架来说，这已经可以算是很老了，但Calabash依然是一个小众产品，然后导致的问题是资料非常非常少……官方Github只给了很简单很基础的API，还基本没有Demo,(官方Demo就几行代码~) 

同时资料少也意味着后面有非常多非常坑需要自己往过趟~

（我大胆的怀疑了一下Calabash小众的原因，可能大厂还是更钟爱appium这种主流测试框架，毕竟语法复杂也意味着更多的可定制性，而小厂呢，相比起维护一套自动化测试框架，不如就手点点人工测试好了，所以Calabash这样的，就处于一个很尴尬的位置了）

## 结论

Calabash的优点让人爱不释手，缺点虽然很痛很痛但肯钻的话也不是不可以客服。
看到这里不知道你有没有意愿去尝试一下Calabash。
后面的篇章我将会从零开始为你展开Calabash的世界！


</br>
 
------

《App自动化测试探索1-大话App自动化测试》
[《App自动化测试探索2-Run Calabash》](https://lizhaoxuan.github.io/2017/02/14/App自动化测试探索2-Run%20Calabash/)
[《App自动化测试探索3-Calabash用法详解》](https://lizhaoxuan.github.io/2017/02/13/App自动化测试探索3-Calabash用法详解/)
[《App自动化测试探索4-Calabash进阶》](https://lizhaoxuan.github.io/2017/02/12/App自动化测试探索4-Calabash进阶/)
[《App自动化测试探索5-Calabash踩坑总结》](https://lizhaoxuan.github.io/2017/02/11/App自动化测试探索5-Calabash踩坑总结/)







